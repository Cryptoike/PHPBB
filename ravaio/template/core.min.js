var phpbb={};phpbb.alertTime=100,function(t){"use strict";var e,a={TAB:9,ENTER:13,ESC:27},r=t("#darkenwrapper"),n=null;phpbb.isTouch=window&&void 0!==window.ontouchstart,phpbb.loadingIndicator=function(){return e||(e=t("<div />",{id:"loading-indicator",class:"loading-indicator"})).appendTo("body"),e.is(":visible")||(e.fadeIn(phpbb.alertTime),phpbb.clearLoadingTimeout(),n=setTimeout(function(){phpbb.showTimeoutMessage()},6e4)),e},phpbb.showTimeoutMessage=function(){var a=t("#phpbb_alert");e.is(":visible")&&phpbb.alert(a.attr("data-l-err"),a.attr("data-l-timeout-processing-req"))},phpbb.clearLoadingTimeout=function(){null!==n&&(clearTimeout(n),n=null)},phpbb.closeDarkenWrapper=function(e){n=setTimeout(function(){t("#darkenwrapper").trigger("click")},e)},phpbb.alert=function(e,r){var n=t("#phpbb_alert");return n.find(".alert_title").html(e),n.find(".alert_text").html(r),t(document).on("keydown.phpbb.alert",function(t){t.keyCode!==a.ENTER&&t.keyCode!==a.ESC||(phpbb.alert.close(n,!0),t.preventDefault(),t.stopPropagation())}),phpbb.alert.open(n),n},phpbb.alert.open=function(t){r.is(":visible")||r.fadeIn(phpbb.alertTime),e&&e.is(":visible")?e.fadeOut(phpbb.alertTime,function(){r.append(t),t.fadeIn(phpbb.alertTime)}):r.is(":visible")?(r.append(t),t.fadeIn(phpbb.alertTime)):(r.append(t),t.show(),r.fadeIn(phpbb.alertTime)),t.on("click",function(t){t.stopPropagation()}),r.one("click",function(e){phpbb.alert.close(t,!0),e.preventDefault(),e.stopPropagation()}),t.find(".alert_close").one("click",function(e){phpbb.alert.close(t,!0),e.preventDefault()})},phpbb.alert.close=function(e,a){(a?r:e).fadeOut(phpbb.alertTime,function(){e.hide()}),e.find(".alert_close").off("click"),t(document).off("keydown.phpbb.alert")},phpbb.confirm=function(e,r,n){var i=t("#phpbb_confirm");return i.find(".alert_text").html(e),n=n||!0,t(document).on("keydown.phpbb.alert",function(e){if(e.keyCode===a.ENTER||e.keyCode===a.ESC){var r=e.keyCode===a.ENTER?"confirm":"cancel";t('input[name="'+r+'"]').trigger("click"),e.preventDefault(),e.stopPropagation()}}),i.find('input[type="button"]').one("click.phpbb.confirmbox",function(t){var e="confirm"===this.name;e&&r(!0),i.find('input[type="button"]').off("click.phpbb.confirmbox"),phpbb.alert.close(i,n||!e),t.preventDefault(),t.stopPropagation()}),phpbb.alert.open(i),i},phpbb.parseQuerystring=function(t){var e,a,r={};for(t=t.split("&"),e=0;e<t.length;e++)r[(a=t[e].split("="))[0]]=decodeURIComponent(a[1]);return r},phpbb.ajaxify=function(a){var i,o=t(a.selector),l=a.refresh,s=a.callback,p=void 0===a.overlay||a.overlay,c=o.is("form"),d=o.is('input[type="text"], textarea');return i=c?"submit":d?"keyup":"click",o.on(i,function(i){function o(t,e,a){"undefined"!=typeof console&&console.log&&console.log("AJAX error. status: "+e+", message: "+a),phpbb.clearLoadingTimeout();var n,i=!1;try{n=(n=JSON.parse(t.responseText)).message}catch(t){}"string"==typeof n&&n.length>0?i=n:"string"==typeof a&&a.length>0?i=a:"string"==typeof(i=r.attr("data-ajax-error-text-"+e))&&i.length||(i=r.attr("data-ajax-error-text")),phpbb.alert(r.attr("data-ajax-error-title"),i)}function h(a){var i;phpbb.clearLoadingTimeout(),void 0===a.S_CONFIRM_ACTION?(void 0!==a.MESSAGE_TITLE?i=phpbb.alert(a.MESSAGE_TITLE,a.MESSAGE_TEXT):(r.fadeOut(phpbb.alertTime),e&&e.fadeOut(phpbb.alertTime)),"function"==typeof phpbb.ajaxCallbacks[s]&&phpbb.ajaxCallbacks[s].call(v,a),a.REFRESH_DATA&&("function"==typeof l?l=l(a.REFRESH_DATA.url):"boolean"!=typeof l&&(l=!1),n=setTimeout(function(){l&&(window.location=a.REFRESH_DATA.url),r.fadeOut(phpbb.alertTime,function(){void 0!==i&&i.hide()})},1e3*a.REFRESH_DATA.time))):phpbb.confirm(a.MESSAGE_BODY,function(e){e&&(phpbb.loadingIndicator(),f=t("<form>"+a.S_HIDDEN_FIELDS+"</form>").serialize(),t.ajax({url:a.S_CONFIRM_ACTION,type:"POST",data:f+"&confirm="+a.YES_VALUE+"&"+t("form","#phpbb_confirm").serialize(),success:h,error:o}))},!1)}var b,u,f,g,v=this,m=t(this);if("false"!==m.find('input[type="submit"][data-clicked]').attr("data-ajax")){var w="function"==typeof a.filter;if(f={},c)b=m.attr("action").replace("&amp;","&"),f=m.serializeArray(),u=m.attr("method")||"GET",m.find('input[type="submit"][data-clicked]')&&(g=m.find('input[type="submit"][data-clicked]'),f.push({name:g.attr("name"),value:g.val()}));else if(d){var y=m.attr("data-name")||this.name;b=m.attr("data-url").replace("&amp;","&"),f[y]=this.value,u="POST"}else b=this.href,f=null,u="GET";var C=function(){var a=m.attr("data-overlay");!p||void 0!==a&&"true"!==a||phpbb.loadingIndicator(),t.ajax({url:b,type:u,data:f,success:h,error:o,cache:!1}).always(function(){e&&e.is(":visible")&&e.fadeOut(phpbb.alertTime)})};w&&!a.filter.call(this,f,i,C)||(C(),i.preventDefault())}}),c&&o.find("input:submit").click(function(){var e=t(this);e.parents("form:first").find("input:submit[data-clicked]").removeAttr("data-clicked"),e.attr("data-clicked","true")}),this},phpbb.search={cache:{data:[]},tpl:[],container:[]},phpbb.search.cache.get=function(t){return!!this.data[t]&&this.data[t]},phpbb.search.cache.set=function(t,e,a){this.data[t]||(this.data[t]={results:[]}),this.data[t][e]=a},phpbb.search.cache.setResults=function(t,e,a){this.data[t].results[e]=a},phpbb.search.cleanKeyword=function(e){return t.trim(e).toLowerCase()},phpbb.search.getKeyword=function(t,e,a){if(a){var r=phpbb.search.getKeywordLine(t);e=e.split("\n").splice(r,1)}return phpbb.search.cleanKeyword(e)},phpbb.search.getKeywordLine=function(t){var e=t.get(0).selectionStart;return t.val().substr(0,e).split("\n").length-1},phpbb.search.setValue=function(t,e,a){if(a){var r=phpbb.search.getKeywordLine(t),n=t.val().split("\n");n[r]=e,e=n.join("\n")}t.val(e)},phpbb.search.setValueOnClick=function(t,e,a,r){a.click(function(){phpbb.search.setValue(t,e.result,t.attr("data-multiline")),r.hide()})},phpbb.search.filter=function(e,a,r){var n=t(this),i=void 0!==n.attr("data-name")?n.attr("data-name"):n.attr("name"),o=parseInt(n.attr("data-min-length"),10),l=n.attr("data-results"),s=phpbb.search.getKeyword(n,e[i],n.attr("data-multiline")),p=phpbb.search.cache.get(l),c=!0;e[i]=s,p.timeout&&clearTimeout(p.timeout);var d=setTimeout(function(){if(o>s.length)c=!1;else if(p.lastSearch)if(p.lastSearch===s)c=!1;else{if(p.results[s]){var t={keyword:s,results:p.results[s]};phpbb.search.handleResponse(t,n,!0),c=!1}0===s.indexOf(p.lastSearch)&&0===p.results[p.lastSearch].length&&(phpbb.search.cache.set(l,"lastSearch",s),phpbb.search.cache.setResults(l,s,[]),c=!1)}c&&r.call(this)},350);return phpbb.search.cache.set(l,"timeout",d),!1},phpbb.search.handleResponse=function(e,a,r,n){if("object"==typeof e){var i=a.attr("data-results"),o=t(i);this.cache.get(i).callback?n=this.cache.get(i).callback:"function"==typeof n&&this.cache.set(i,"callback",n),r||this.cache.setResults(i,e.keyword,e.results),this.cache.set(i,"lastSearch",e.keyword),this.showResults(e.results,a,o,n)}},phpbb.search.showResults=function(e,a,r,n){var i=t(".search-results",r);if(this.clearResults(i),!e.length)return void r.hide();var o,l,s=r.attr("id");this.tpl[s]||(o=t(".search-result-tpl",r),this.tpl[s]=o.clone().removeClass("search-result-tpl"),o.remove()),o=this.tpl[s],t.each(e,function(t,e){(l=o.clone()).find(".search-result").html(e.display),"function"==typeof n&&n.call(this,a,e,l,r),l.appendTo(i).show()}),r.show()},phpbb.search.clearResults=function(t){t.children(":not(.search-result-tpl)").remove()},t("#phpbb").click(function(){var e=t(this);e.is(".live-search")||e.parents().is(".live-search")||t(".live-search").hide()}),phpbb.history={},phpbb.history.isSupported=function(t){return!("undefined"==typeof history||void 0===history[t])},phpbb.history.alterUrl=function(t,e,a,r){var n=t+"State";e&&phpbb.history.isSupported(n)&&(a||(a=document.title),r||(r=null),history[n](r,a,e))},phpbb.history.replaceUrl=function(t,e,a){phpbb.history.alterUrl("replace",t,e,a)},phpbb.history.pushUrl=function(t,e,a){phpbb.history.alterUrl("push",t,e,a)},phpbb.timezoneSwitchDate=function(e){var a=t("#timezone_copy"),r=t("#timezone"),n=t("#tz_date"),i=t("#tz_select_date_suggest");0===a.length?r.clone().attr("id","timezone_copy").css("display","none").attr("name","tz_copy").insertAfter("#timezone"):r.html(a.html()),""!==n.val()&&r.children("optgroup").remove(':not([data-tz-value="'+n.val()+'"])'),n.val()===i.attr("data-suggested-tz")?i.css("display","none"):i.css("display","inline");var o=r.children('optgroup[data-tz-value="'+n.val()+'"]').children("option");if(1===o.length&&(o.prop("selected",!0),e=!0),void 0!==e&&!e){var l=r.find("optgroup option");l.filter(":selected").length<=0&&l.filter(":first").prop("selected",!0)}},phpbb.timezoneEnableDateSelection=function(){t("#tz_select_date").css("display","block")},phpbb.timezonePreselectSelect=function(e){var a=(new Date).getTimezoneOffset(),r="-";a<0&&(r="+",a=-a);var n,i=a%60,o=(a-i)/60,l="UTC"+r+(o=o<10?"0"+o.toString():o.toString())+":"+(i=i<10?"0"+i.toString():i.toString()),s=l.length,p=t("option","#tz_date"),c=t("#tz_select_date_suggest");for(n=0;n<p.length;++n){var d=p[n];if(d.value.substring(0,s)===l){t("#tz_date").val()===d.value||e?(d.selected=!0,phpbb.timezoneSwitchDate(!e),c.css("display","none")):(phpbb.timezoneSwitchDate(!0),c.css("display","inline"));var h=c.attr("data-l-suggestion");return c.attr("title",h.replace("%s",d.innerHTML)),c.attr("value",h.replace("%s",d.innerHTML.substring(0,9))),void c.attr("data-suggested-tz",d.innerHTML)}}},phpbb.ajaxCallbacks={},phpbb.addAjaxCallback=function(t,e){return"function"==typeof e&&(phpbb.ajaxCallbacks[t]=e),this},phpbb.addAjaxCallback("member_search",function(e){phpbb.search.handleResponse(e,t(this),!1,phpbb.getFunctionByName("phpbb.search.setValueOnClick"))}),phpbb.addAjaxCallback("alt_text",function(){var e,a=t(this).data("update-all");t(void 0!==a&&a.length?a:this).each(function(){var a=t(this);e=a.attr("data-alt-text"),a.attr("data-alt-text",a.text()),a.attr("title",t.trim(e)),a.text(e)})}),phpbb.addAjaxCallback("toggle_link",function(){var e,a,r,n=t(this).data("update-all");t(void 0!==n&&n.length?n:this).each(function(){var n=t(this);a=n.attr("data-toggle-url"),n.attr("data-toggle-url",n.attr("href")),n.attr("href",a),r=n.attr("data-toggle-class"),n.attr("data-toggle-class",n.children().attr("class")),n.children(".icon").attr("class",r),e=n.attr("data-toggle-text"),n.attr("data-toggle-text",n.children("span").text()),n.attr("title",t.trim(e)),n.children("span").text(e)})}),phpbb.resizeTextArea=function(e,a){function r(e){var a=t(e);a.hasClass("auto-resized")&&(t(e).css({height:"",resize:""}).removeClass("auto-resized"),i.resetCallback.call(e,a))}function n(e){function a(t){t+=parseInt(l.css("height"),10)-l.innerHeight(),l.css({height:t+"px",resize:"none"}).addClass("auto-resized"),i.resizeCallback.call(e,l)}var n=t(window).height();if(n<i.minWindowHeight)return void r(e);var o=Math.min(Math.max(n-i.heightDiff,i.minHeight),i.maxHeight),l=t(e),s=parseInt(l.innerHeight(),10),p=e.scrollHeight?e.scrollHeight:0;s<0||(s>o?a(o):p>s+5&&a(Math.min(o,p)))}var i={minWindowHeight:500,minHeight:200,maxHeight:500,heightDiff:200,resizeCallback:function(){},resetCallback:function(){}};phpbb.isTouch||(arguments.length>1&&(i=t.extend(i,a)),e.on("focus change keyup",function(){t(this).each(function(){n(this)})}).change(),t(window).resize(function(){e.each(function(){t(this).hasClass("auto-resized")&&n(this)})}))},phpbb.inBBCodeTag=function(t,e,a){var r,n,i,o=t.selectionStart,l=-1,s=-1;if("number"!=typeof o)return!1;for(i=t.value.toLowerCase(),r=0;r<e.length;r++){var p=e[r].length;o>=p&&(n=i.lastIndexOf(e[r],o-p),s=Math.max(s,n))}if(-1===s)return!1;if(o>0)for(r=0;r<a.length;r++)n=i.lastIndexOf(a[r],o-1),l=Math.max(l,n);return l<s},phpbb.applyCodeEditor=function(e){function r(){return phpbb.inBBCodeTag(e,o,s)}function n(t){var a=e.selectionStart,r=e.value,n=r.lastIndexOf("\n",a-1);if(r=r.substring(n+1,a),t)for(var i=0;i<o.length;i++)if((n=r.lastIndexOf(o[i]))>=0){var s=o[i].length;r=r.substring(n+s),o[i].lastIndexOf(l)!==s&&(n=r.indexOf(l))>=0&&(r=r.substr(n+1))}return r}function i(t){var a=e.selectionStart,r=e.selectionEnd,n=e.value;e.value=n.substr(0,a)+t+n.substr(r),e.selectionStart=e.selectionEnd=a+t.length}var o=["[code]","[code="],l="]",s=["[/code]"];e&&"number"==typeof e.selectionStart&&!0!==t(e).data("code-editor")&&t(e).data("code-editor",!0).on("keydown",function(t){var e=t.keyCode||t.which;if(!(e!==a.TAB||t.ctrlKey||t.shiftKey||t.altKey||t.metaKey)&&r())return i("\t"),void t.preventDefault();if(e===a.ENTER&&r()){var o=n(!0),l=""+/^\s*/g.exec(o);l.length>0&&(i("\n"+l),t.preventDefault())}})},phpbb.showDragNDrop=function(e){e&&(t("body").on("dragenter dragover",function(){t(e).addClass("drag-n-drop")}).on("dragleave dragout dragend drop",function(){t(e).removeClass("drag-n-drop")}),t(e).on("dragenter dragover",function(){t(e).addClass("drag-n-drop-highlight")}).on("dragleave dragout dragend drop",function(){t(e).removeClass("drag-n-drop-highlight")}))},phpbb.dropdownHandles=".dropdown-container.dropdown-visible .dropdown-toggle",phpbb.dropdownVisibleContainers=".dropdown-container.dropdown-visible",phpbb.toggleDropdown=function(){var e,a=t(this),r=a.data("dropdown-options"),n=r.parent,i=n.hasClass("dropdown-visible");if(!i){t(phpbb.dropdownHandles).each(phpbb.toggleDropdown),e=r.direction;var o=r.verticalDirection,l=a.offset();if("auto"===e&&(e=(t(window).width()-a.outerWidth(!0))/2>l.left?"right":"left"),n.toggleClass(r.leftClass,"left"===e).toggleClass(r.rightClass,"right"===e),"auto"===o){var s=t(window).height();o=l.top-t(window).scrollTop()<.7*s?"down":"up"}n.toggleClass(r.upClass,"up"===o).toggleClass(r.downClass,"down"===o)}if(r.dropdown.toggle(),n.toggleClass(r.visibleClass,!i).toggleClass("dropdown-visible",!i),!i){var p=t(window).width();r.dropdown.find(".dropdown-contents").each(function(){var e=t(this);e.css({marginLeft:0,left:0,maxWidth:p-4+"px"});var a=e.offset().left,r=e.outerWidth(!0);a<2?e.css("left",2-a+"px"):a+r+2>p&&e.css("margin-left",p-a-r-2+"px"),e.toggleClass("dropdown-nonscroll",this.scrollHeight===e.innerHeight())});var c=n.offset().left-4;if("left"===e){if(r.dropdown.css("margin-left","-"+c+"px"),r.dropdown.hasClass("dropdown-extended")){var d,h=c+n.outerWidth();r.dropdown.find(".dropdown-contents").each(function(){d=parseInt(t(this).outerWidth(),10),t(this).css({marginLeft:0,left:0})});var b=Math.min(d,h)+"px";r.dropdown.css({width:b,marginLeft:-b})}}else r.dropdown.css("margin-right","-"+(p+c)+"px")}if(arguments.length>0)try{var u=arguments[0];u.preventDefault(),u.stopPropagation()}catch(t){}return!1},phpbb.toggleSubmenu=function(e){t(this).siblings(".dropdown-submenu").toggle(),e.preventDefault()},phpbb.registerDropdown=function(e,a,r){var n={parent:e.parent(),direction:"auto",verticalDirection:"auto",visibleClass:"visible",leftClass:"dropdown-left",rightClass:"dropdown-right",upClass:"dropdown-up",downClass:"dropdown-down"};r&&(n=t.extend(n,r)),n.dropdown=a,n.parent.addClass("dropdown-container"),e.addClass("dropdown-toggle"),e.data("dropdown-options",n),e.click(phpbb.toggleDropdown),t(".dropdown-toggle-submenu",n.parent).click(phpbb.toggleSubmenu)},phpbb.colorPalette=function(t,e,a){var r,n,i,o=new Array(6),l="",s="";for(o[0]="00",o[1]="40",o[2]="80",o[3]="BF",o[4]="FF",s+='<table class="not-responsive colour-palette '+("h"===t?"horizontal-palette":"vertical-palette")+'" style="width: auto;">',r=0;r<5;r++){for("h"===t&&(s+="<tr>"),n=0;n<5;n++){for("v"===t&&(s+="<tr>"),i=0;i<5;i++)s+='<td style="background-color: #'+(l=""+o[r]+o[n]+o[i])+"; width: "+e+"px; height: "+a+'px;"><a href="#" data-color="'+l+'" style="display: block; width: '+e+"px; height: "+a+'px; " alt="#'+l+'" title="#'+l+'"></a>',s+="</td>";"v"===t&&(s+="</tr>")}"h"===t&&(s+="</tr>")}return s+="</table>"},phpbb.registerPalette=function(e){var a=e.attr("data-orientation"),r=e.attr("data-height"),n=e.attr("data-width"),i=e.attr("data-target"),o=e.attr("data-bbcode");e.html(phpbb.colorPalette(a,n,r)),t("#color_palette_toggle").click(function(t){e.toggle(),t.preventDefault()}),t(e).on("click","a",function(e){var a=t(this).attr("data-color");o?bbfontstyle("[color=#"+a+"]","[/color]"):t(i).val(a),e.preventDefault()})},phpbb.toggleDisplay=function(e,a,r){r||(r="block");var n=t("#"+e),i=n.css("display");a||(a=""===i||i===r?-1:1),n.css("display",1===a?r:"none")},phpbb.toggleSelectSettings=function(e){e.children().each(function(){var e=t(this);t(e.data("toggle-setting")).toggle(e.is(":selected")),e.is(":selected")?t(e.data("toggle-setting")+" input").prop("disabled",!1):t(e.data("toggle-setting")+" input").prop("disabled",!0)})},phpbb.getFunctionByName=function(t){for(var e=t.split("."),a=e.pop(),r=window,n=0;n<e.length;n++)r=r[e[n]];return r[a]},phpbb.registerPageDropdowns=function(){var e=t("body");e.find(".dropdown-container").each(function(){var e,a=t(this),r=a.find(".dropdown-trigger:first"),n=a.find(".dropdown"),i={direction:"auto",verticalDirection:"auto"};r.length||(r=(e=a.attr("data-dropdown-trigger"))?a.children(e):a.children("a:first")),n.length||(n=(e=a.attr("data-dropdown-contents"))?a.children(e):a.children("div:first")),r.length&&n.length&&(a.hasClass("dropdown-up")&&(i.verticalDirection="up"),a.hasClass("dropdown-down")&&(i.verticalDirection="down"),a.hasClass("dropdown-left")&&(i.direction="left"),a.hasClass("dropdown-right")&&(i.direction="right"),phpbb.registerDropdown(r,n,i))}),e.click(function(e){t(e.target).parents().is(phpbb.dropdownVisibleContainers)||t(phpbb.dropdownHandles).each(phpbb.toggleDropdown)})},phpbb.lazyLoadAvatars=function(){t(".avatar[data-src]").each(function(){var e=t(this);e.attr("src",e.data("src")).removeAttr("data-src")})},t(window).load(phpbb.lazyLoadAvatars),t(function(){t("textarea[data-bbcode]").each(function(){phpbb.applyCodeEditor(this)}),phpbb.registerPageDropdowns(),t("#color_palette_placeholder").each(function(){phpbb.registerPalette(t(this))}),phpbb.history.replaceUrl(t("#unread[data-url]").data("url")),t("select[data-togglable-settings]").each(function(){var e=t(this);e.change(function(){phpbb.toggleSelectSettings(e)}),phpbb.toggleSelectSettings(e)})})}(jQuery);